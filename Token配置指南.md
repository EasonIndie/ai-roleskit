# æ™ºè°±AI Tokené…ç½®æŒ‡å—

## ğŸ“Š æ™ºè°±å¤§æ¨¡å‹Tokené™åˆ¶

æ ¹æ®ä½ çš„é…ç½®ï¼Œæ™ºè°±å¤§æ¨¡å‹æ”¯æŒçš„æœ€å¤§Tokené™åˆ¶å¦‚ä¸‹ï¼š

| æ¨¡å‹ | æœ€å¤§Tokené™åˆ¶ | é€‚ç”¨åœºæ™¯ |
|------|-------------|----------|
| `glm-4` | **8,192** | é€šç”¨å¯¹è¯ã€å¤æ‚é—®é¢˜ |
| `glm-4-flash` | **8,192** | å¿«é€Ÿå“åº”ã€å®æ—¶äº¤äº’ |
| `glm-4-air` | **8,192** | é•¿æ–‡æœ¬ã€æ–‡æ¡£å¤„ç† |
| `glm-4-long` | **32,768** | è¶…é•¿æ–‡æœ¬ã€ä»£ç åˆ†æ |

## ğŸ¯ å½“å‰é…ç½®åˆ†æ

ä½ çš„ `config/default.yaml` é…ç½®ï¼š
```yaml
zhipu:
  model: "glm-4"
  max_tokens: 2000  # å½“å‰è®¾ç½®
```

## âš–ï¸ Tokenæ•°é‡ä¸æ˜¯è¶Šå¤§è¶Šå¥½

### ä¸ºä»€ä¹ˆä¸åº”è¯¥è®¾ç½®æœ€å¤§å€¼ï¼Ÿ

1. **æˆæœ¬è€ƒè™‘**
   - Tokenä½¿ç”¨é‡ç›´æ¥å½±å“è´¹ç”¨
   - è¿‡å¤§çš„max_tokenså¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„æ¶ˆè€—

2. **å“åº”æ—¶é—´**
   - Tokenè¶Šå¤šï¼Œç”Ÿæˆæ—¶é—´è¶Šé•¿
   - å½±å“ç”¨æˆ·ä½“éªŒ

3. **å›ç­”è´¨é‡**
   - è¿‡é•¿å›ç­”å¯èƒ½åŒ…å«å†—ä½™ä¿¡æ¯
   - é€‚ä¸­çš„é•¿åº¦å¾€å¾€æ›´ç²¾ç‚¼

4. **å®é™…éœ€æ±‚**
   - å¤§å¤šæ•°å¯¹è¯åœºæ™¯ä¸éœ€è¦è¶…é•¿å›ç­”
   - å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´

## ğŸ› ï¸ æ¨èé…ç½®ç­–ç•¥

### 1. æŒ‰åœºæ™¯åˆ†ç±»é…ç½®

#### ç®€å•é—®ç­”åœºæ™¯
```yaml
zhipu:
  model: "glm-4-flash"
  max_tokens: 300-500
```

#### ä¸“ä¸šå’¨è¯¢åœºæ™¯
```yaml
zhipu:
  model: "glm-4"
  max_tokens: 1000-1500
```

#### æ–‡æ¡£åˆ†æåœºæ™¯
```yaml
zhipu:
  model: "glm-4-long"
  max_tokens: 2000-3000
```

#### åˆ›æ„å†™ä½œåœºæ™¯
```yaml
zhipu:
  model: "glm-4"
  max_tokens: 1500-2500
```

### 2. ä¼˜åŒ–å»ºè®®

#### å½“å‰é…ç½®ä¼˜åŒ–
```yaml
# é€šç”¨å¯¹è¯ - æ¨èé…ç½®
zhipu:
  model: "glm-4"
  max_tokens: 1200        # ä»2000é™ä½åˆ°1200
  temperature: 0.7
  timeout: 30
```

#### æŒ‰æ¨¡å‹ç±»å‹é…ç½®

```yaml
# å¯¹è¯åœºæ™¯é…ç½®
zhipu:
  model: "glm-4-flash"
  max_tokens: 500
  temperature: 0.8

# ä¸“ä¸šå’¨è¯¢é…ç½®
zhipu:
  model: "glm-4"
  max_tokens: 1500
  temperature: 0.6

# é•¿æ–‡æ¡£é…ç½®
zhipu:
  model: "glm-4-long"
  max_tokens: 3000
  temperature: 0.5
```

## ğŸ“ˆ Tokenä½¿ç”¨ç»Ÿè®¡

### ä¸­æ–‡Tokenè®¡ç®—
- ä¸­æ–‡ï¼šçº¦1.5-2ä¸ªå­—ç¬¦ = 1ä¸ªToken
- è‹±æ–‡ï¼šçº¦4ä¸ªå­—ç¬¦ = 1ä¸ªToken
- ä»£ç ï¼šçº¦1ä¸ªå­—ç¬¦ = 1ä¸ªToken

### å®é™…ä¾‹å­
```text
1000 Tokens â‰ˆ
- ä¸­æ–‡: 500-700å­—
- è‹±æ–‡: 4000å­—ç¬¦
- ä»£ç : 1000å­—ç¬¦
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åŠ¨æ€è°ƒæ•´ç­–ç•¥

```python
# æ ¹æ®é—®é¢˜å¤æ‚åº¦è°ƒæ•´token
def get_token_limit(question_length, complexity):
    if complexity == "simple":
        return min(500, question_length * 2)
    elif complexity == "medium":
        return min(1500, question_length * 3)
    else:
        return min(3000, question_length * 4)
```

### 2. æµå¼è¾“å‡ºä¼˜åŒ–

```python
# ä½¿ç”¨æµå¼è¾“å‡ºæ”¹å–„ç”¨æˆ·ä½“éªŒ
request = AIRequest(
    messages=[...],
    max_tokens=1200,  # åˆç†çš„tokené™åˆ¶
    stream=True
)

async for chunk in provider.chat_completion_stream(request):
    print(chunk, end="", flush=True)
```

### 3. æˆæœ¬ç›‘æ§

```python
# ç›‘æ§tokenä½¿ç”¨æƒ…å†µ
def monitor_usage(response):
    if response.usage:
        tokens_used = response.usage['total_tokens']
        cost = tokens_used * 0.001  # å‡è®¾æ¯token 0.001å…ƒ
        print(f"æœ¬æ¬¡å¯¹è¯ä½¿ç”¨: {tokens_used} tokens, è´¹ç”¨: Â¥{cost:.4f}")
```

## ğŸ”§ é…ç½®è°ƒæ•´æ–¹æ³•

### æ–¹æ³•1: ä¿®æ”¹é…ç½®æ–‡ä»¶
ç¼–è¾‘ `config/default.yaml`ï¼š
```yaml
zhipu:
  model: "glm-4"
  max_tokens: 1200  # è°ƒæ•´ä¸ºæ›´åˆé€‚çš„å€¼
  temperature: 0.7
  timeout: 30
```

### æ–¹æ³•2: è¿è¡Œæ—¶è¦†ç›–
```python
# åœ¨ä»£ç ä¸­åŠ¨æ€è®¾ç½®
provider = ZhipuProvider({
    'api_key': api_key,
    'model': 'glm-4',
    'max_tokens': 1200  # è¦†ç›–é»˜è®¤é…ç½®
})
```

### æ–¹æ³•3: æŒ‰è¯·æ±‚è®¾ç½®
```python
# ä¸ºæ¯ä¸ªè¯·æ±‚å•ç‹¬è®¾ç½®
request = AIRequest(
    messages=[...],
    max_tokens=800,  # é’ˆå¯¹å½“å‰è¯·æ±‚çš„tokené™åˆ¶
    temperature: 0.7
)
```

## ğŸ“‹ æ¨èé…ç½®å€¼

| åœºæ™¯ | æ¨¡å‹ | æ¨èmax_tokens | è¯´æ˜ |
|------|------|---------------|------|
| æ—¥å¸¸å¯¹è¯ | glm-4-flash | 300-500 | å¿«é€Ÿå“åº” |
| ä¸“ä¸šå’¨è¯¢ | glm-4 | 1000-1500 | æ·±åº¦å›ç­” |
| æ–‡æ¡£æ€»ç»“ | glm-4 | 800-1200 | ç²¾ç‚¼æ€»ç»“ |
| åˆ›æ„å†™ä½œ | glm-4 | 1500-2000 | å……åˆ†å‘æŒ¥ |
| ä»£ç è§£é‡Š | glm-4 | 500-1000 | æŠ€æœ¯è¯´æ˜ |
| é•¿æ–‡åˆ†æ | glm-4-long | 2000-3000 | è¯¦ç»†åˆ†æ |

## ğŸ¯ æ€»ç»“

1. **Tokenä¸æ˜¯è¶Šå¤§è¶Šå¥½**ï¼Œè¦æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®
2. **å½“å‰2000ç¨å¤§**ï¼Œå»ºè®®è°ƒæ•´åˆ°1200-1500
3. **æŒ‰åœºæ™¯é€‰æ‹©æ¨¡å‹å’Œtokenæ•°**
4. **ç›‘æ§tokenä½¿ç”¨**ï¼Œæ§åˆ¶æˆæœ¬
5. **ä½¿ç”¨æµå¼è¾“å‡º**æ”¹å–„ä½“éªŒ

å»ºè®®ä½ å°† `max_tokens` ä»2000è°ƒæ•´åˆ° **1200**ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´å¹³è¡¡çš„é…ç½®ï¼